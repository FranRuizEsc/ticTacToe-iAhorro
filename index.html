<html lang="es">

<head>
	<meta charset="UTF-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<title>Document</title>
	<link rel="stylesheet" href="styles.css" />
	<!-- Link para usar fuentes de google -->
	<link rel="preconnect" href="https://fonts.googleapis.com" />
	<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
	<link
		href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&family=Roboto:ital,wght@0,100..900;1,100..900&display=swap"
		rel="stylesheet" />
	<!-- Link para usar iconos de font awesome -->
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
</head>

<body>

	<div class="game-table-container">
		<div class="game-table-wrapper">
			<h1 class="game-title">tic tac toe</h1>
			<div class="game-subtitle-separator"></div>
			<span id="start-game-subtitle" class="game-subtitle game-subtitle--start">¡Empezamos!</span>
			<span id="next-player-subtitle" class="game-subtitle game-subtitle--next-player">Turno de: <span
					id="next-player"></span></span>
			<table id="game-table" class="game-table"></table>
			<div class="table-info-container">
				<div class="toggle-images-container">
					<button id="toggle-images-button" class="toggle-images-button" onclick="toggleImages()">
						Cambia el color
					</button>
				</div>
				<p class="info-title">Puntuación</p>
				<div class="info-score-container">
					<div class="info-score-item">
						<img src="http://cdn.iahorro.com/internal-resources/it-technical-test/x.png" class="icon" />
						<p class="score-item">- <span id="x-wins">0</span></p>
					</div>
					<div class="info-score-item">
						<img src="http://cdn.iahorro.com/internal-resources/it-technical-test/o.png" class="icon" />
						<p class="score-item">- <span id="o-wins">0</span></p>
					</div>
				</div>
			</div>
			<button id="new-game-button" class="new-game-button" onclick="resetGame()">
				Nuevo juego
			</button>
		</div>
	</div>

	<dialog id="dialog" class="dialog">
		<div class="dialog-container">
			<div class="dialog-wrapper">
				<h2 id="dialog-title" class="dialog-title"></h2>
				<img id="dialog-image" src="" alt="Ganador" class="win-dialog-image" />
			</div>
			<i id="dialog-icon" class="dialog-icon"></i>
			<p id="dialog-subtitle" class="dialog-subtitle"></p>
		</div>
		<div class="dialog-button-container">
			<button class="dialog-button" onclick="closeDialog()">
				Jugar otra
			</button>
		</div>
	</dialog>

	<div class="analysis-container">
		<h1>Análisis y Explicaciones</h1>

		<h2>Procesador de estilos utilizado:</h2>
		<ul>
			<li>
				Utilicé <code>SCSS</code>, me parece la mejor sintaxis, más clara y
				limpia.
			</li>
		</ul>

		<h2>Análisis del código y cambios realizados:</h2>
		<ul>
			<li>
				Cambié la estructura del código de <code>JavaScript</code> para que
				fuera más legible, fácil de escalar y mantener.
			</li>
			<li>
				Con el código suelto cree funciones para mejorar la calidad y poder
				reutilizarlo en caso de ser necesario y eliminé el innecesario.
			</li>
			<li>
				Cree la función <code>initialBoard()</code> con el código suelto:
			</li>
		</ul>

		<pre><code>
          let table = document.getElementById("game-table");
          for (let i = 0; i < table.rows.length; i++) {
              for (let j = 0; j < table.rows[i].cells.length; j++) {
                  table.rows[i].cells[j].onclick = function() {
                      if (state[i][j] === null && winner === null) {
                          state[i][j] = currentPlayer;
                          this.innerHTML = currentPlayer;
                          winner = findWinner(state);
                          if (winner === 'x') {
                              xWins++;
                              alert("X wins!");
                          } else if (winner === 'o') {
                              oWins++;
                              alert("O wins!");
                          } else {
                              currentPlayer = nextPlayer(state);
                              document.getElementById("next-player").innerHTML = currentPlayer;
                          }
                          document.getElementById("x-wins").innerHTML = xWins;
                          document.getElementById("o-wins").innerHTML = oWins;
                      }
                  }
              }
          }
    </code></pre>

		<ul>
			<li>
				<code>onClick()</code> le cambie el nombre por
				<code>handleClick()</code> para que fuera más descriptivo. <br>
				Llamé a esta función al manejar el click puesto que hacia lo mismo que el
				código anterior y no se duplica. <br>
				También modifiqué la función <code>handleClick()</code>, moviendo la lógica que chequea el ganador
				y el empate, ya que esa funcionalidad ahora se maneja en la función
				<code>handleTurn()</code>, anteriormente llamada <code>play()</code>,
				para hacer el nombre más descriptivo.
			</li>
			<li>
				<code>findWinner()</code> modifiqué el código para no repetir tantos condicionales <code>if</code>.<br>
				Para esto cree una matriz con todas las combinaciones ganadoras posibles. Recorro esta matriz y desgloso
				cada línea en celdas correspondientes a cada fila y columna.<br>
				Por último, hago la comprobación de las tres celdas tienen el mismo valor y si lo tienen devuelvo el
				ganador.
			</li>
			<li>
				<code>nextPlayer()</code> simplifiqué la lógica, aplané la matriz y la
				convertí en un array. <br>
				Luego lo recorro una vez filtrando las <code>"x"</code> y otra para las <code>"o"</code> contabilizando
				ambas
				para luego poder hacer la comprobación de si son iguales devuelvo la
				<code>"x"</code> y si no la <code>"o"</code>. <br>
				Cambié el <code>if</code> por un ternario, porque me pareció más legible.
			</li>
			<li>
				<code>populate()</code>, cree una condición que comprueba si hay una
				tabla y si no la hay, imprime un <code>console log</code> indicando un
				error. <br>
				Cambié los bucles <code>for</code> por <code>forEach</code>,
				porque me parece más legible. <br>
				También aproveché para añadir clases a las filas y a las celdas para cambiar los estilos más
				específicamente.
			</li>
			<li>
				El botón para empezar un "juego nuevo" se crea directamente en el
				<code>HTML</code>, puesto que siempre será visible y mejora el
				rendimiento. <br>
				Además desde el <code>HTML</code> manejo el click
				eliminando así el código repetido que se está llamando en la función
				<code>reset()</code> que es a la que llamo desde el click. <br>
				El código eliminado es:
			</li>
		</ul>

		<pre><code>
          let newGameButton = document.createElement("button");
          newGameButton.innerHTML = "Nuevo juego";
          newGameButton.onclick = function() {
              state = [
                  [ null, null, null ],
                  [ null, null, null ],
                  [ null, null, null ]
              ];
              currentPlayer = 'x';
              winner = null;
              for (let i = 0; i < table.rows.length; i++) {
                  for (let j = 0; j < table.rows[i].cells.length; j++) {
                      table.rows[i].cells[j].innerHTML = "";
                  }
              }
              document.getElementById("next-player").innerHTML = currentPlayer;
          }
          document.body.prepend(newGameButton);
    </code></pre>

		<ul>
			<li>
				Parte del código que estaba situado al final del todo la eliminé,
				puesto que estaba repetido:
			</li>
		</ul>

		<pre><code>
          for (let i = 0; i < table.rows.length; i++) {
              for (let j = 0; j < table.rows[i].cells.length; j++) {
                  table.rows[i].cells[j].onclick = onClick;
              }
          }
    </code></pre>

		<ul>
			<li>
				Cree variables y constantes globales, puesto que se usaban en varios
				sitios, haciéndolo más reutilizables y fáciles de leer.
			</li>
		</ul>

		<h2>Para el botón de cambiar el color:</h2>
		<ul>
			<li>
				Cree varias funciones para manejar el cambio de color o en este caso
				cambiar las imágenes mostradas según la selección.
			</li>
			<li>
				Hice unas constantes globales con cada imagen para que fuera más fácil
				su manejo. Una vez hecho esto, cree una función para obtener las
				imágenes actuales, <code>getCurrentImages()</code>.
			</li>
			<li>
				Luego cree la función que maneja el cambio de las imágenes en sí,
				<code>toggleImages()</code>, lo que hace es determinar si se están
				usando las imágenes alternativas o no, una vez comprobado esto,
				obtiene las imágenes correspondientes asignándoselas a cada jugador.
			</li>
			<li>
				Se llama a la función <code>updateCellColor()</code>, que actualiza el
				color de fondo de la celda.
			</li>
			<li>
				Con los <code>querySelectors</code> del final se actualizan las
				imágenes en el marcador del tablero y
				<code>nextPlayerElement</code> actualiza la imagen del siguiente
				jugador.
			</li>
			<li>
				Para actualizar el color de fondo de cada celda según corresponda cree
				<code>updateCellColor()</code>, primero limpia las celdas por si
				tuvieran alguna clase y luego se le añade una clase nueva según sea
				alternativa o no.
			</li>
		</ul>

		<h2>Para cambiar el subtítulo:</h2>
		<ul>
			<li>
				Cree una función para manejar el subtitulo que se debe mostrar, <code>handleSubtitle()</code>.
			</li>
			<li>
				Cuando aún no ha hecho ningun movimiento o se reinicia el tablero, se envia un true y se muestra el
				startSubtitle y se oculta el <code>nextPlayerSubtitle</code>.
			</li>
			<li>
				Al hacer algún movimiento se hace lo contrario a lo anterior.
			</li>
			<li>
				Sólo en el subtitulo de nextPlayer se setea la imagen de del jugador.
			</li>
		</ul>

		<h2>Funcionalidades extra:</h2>
		<h3>Diálogos de victoria y empate:</h3>
		<ul>
			<li>
				A mayores cree unos diálogos que muestro según se gane o empate.
			</li>
			<li>
				En el diálogo de ganador muestro la imagen del ganador y en el de
				empate solo muestra texto.
			</li>
			<li>Al pulsar en el botón en ambos diálogos se reinicia el juego.</li>
			<li>
				Para manejar cada diálogo, cree una función que comprueba si hay un
				ganador o no, y rellena cada elemento del diálogo según corresponda.
			</li>
		</ul>

		<h3>Navegación por el tablero con el teclado:</h3>
		<ul>
			<li>
				En <code>initializeGameBoard()</code>, agregué <code>tabindex</code> a cada celda para que sea accesible
				por teclado y le asigné el evento <code>"Enter"</code>, que añade la imagen correspondiente al jugador
				actual.
			</li>
			<li>
				Cree <code>handleKeyboardNavigation()</code>, aquí manejo los eventos del teclado y según la tecla
				pulsada se hace el movimiento correspondiente.
			</li>
			<li>
				Por último, añadí al código global un <code>preventDefault()</code> para evitar que se cierre el diálogo
				automáticamente cuando muestra un ganador después de interactuar con el teclado.
			</li>
		</ul>

		<h3>En el códgo hay comentarios explicativos de algunas mejoras.</h3>
	</div>
	<script src="javascript.js"></script>
</body>

</html>